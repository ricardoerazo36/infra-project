version: '3.8'

services:
  # Descargador de noticias RSS
  downloader:
    build: ./downloader
    container_name: news_downloader
    volumes:
      - ./data/raw:/app/data/raw
    environment:
      - SLEEP_INTERVAL=3600
    restart: unless-stopped
    command: ["python", "main_loop.py"]

  # Procesador de texto
  processor:
    build: ./processor
    container_name: news_processor
    volumes:
      - ./data/raw:/app/data/raw
      - ./data/clean:/app/data/clean
    environment:
      - SLEEP_INTERVAL=1800
    restart: unless-stopped
    depends_on:
      - downloader
    command: ["python", "main_loop.py"]

  # Analizador de temas
  analyzer:
    build: ./analyzer
    container_name: news_analyzer
    volumes:
      - ./data/clean:/app/data/clean
      - ./data/analysis:/app/data/analysis
    environment:
      - SLEEP_INTERVAL=1800
    restart: unless-stopped
    depends_on:
      - processor
    command: ["python", "main_loop.py"]

  # Recolector de datos econ√≥micos 
  economic_data:
    build: ./economic_data
    container_name: economic_collector
    volumes:
      - ./data/economic:/app/data/economic
    environment:
      - SLEEP_INTERVAL=3600
      - GEMINI_API_KEY=${GEMINI_API_KEY:-}
    restart: unless-stopped
    command: ["python", "main_loop.py"]

  # Correlador de datos
  correlator:
    build: ./correlator
    container_name: news_correlator
    volumes:
      - ./data/analysis:/app/data/analysis
      - ./data/economic:/app/data/economic
      - ./data/results:/app/data/results
    environment:
      - SLEEP_INTERVAL=3600
    restart: unless-stopped
    depends_on:
      - analyzer
      - economic_data
    command: ["python", "main_loop.py"]

  dashboard:
    build: ./dashboard
    container_name: news_dashboard
    ports:
      - "8080:8080"
    volumes:
      - ./data/results:/app/data/results
      - ./data/analysis:/app/data/analysis  
    restart: unless-stopped
    depends_on:
      - correlator

  # Common Crawl fetcher
  commoncrawl:
    build: ./commoncrawl
    container_name: common_crawl_fetcher
    volumes:
      - ./data/commoncrawl:/app/data/commoncrawl
      - ./data/raw:/app/data/raw
    environment:
      - SLEEP_INTERVAL=86400
    restart: unless-stopped
    command: ["python", "main_loop.py"]

volumes:
  data: